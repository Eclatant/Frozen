내가 만든 언어의 개발환경을 Visual Studio Code로 빠르고 쉽게 구축하기
**내가 만든 언어** : 직전 시간 발표와 이어지는 내용

## 도입
텍스트 기반 도메인 언어 : 첫 버전을 빠르게 만들 수 있음, 변경 추적이 쉬움, 대규모 리팩토링 쉬움, 검색 가능
- 카바티나 스토리 AI 스크립트 FSM : 화살표 왼쪽이 조건식, 행동이 오른쪽, 상태 트랜지션을 대괄호 안, $는 상수값, 상수값 참고 조건식
- 마비노기2 AI 스크립트 HFSM : ndc13에서 발표함
- 데스크탑 히어로즈 던전 스크립트 Lua 

## 어떻게 만드나?
구문 분석=텍스트의 구조 파악
실행=동작하게 하기

### 구문 분석
라인 by 라인 : 간단하면 추천
파서 생성기 : 일반적 - FSM
recursive descent parser : 복잡하면 추천

### 실행
구문 분석 결과를 트리로 구성하고 평가 : 가성비가 좋음
다른 언어로 트랜스파일(번역) : 동적 로드가 가능하면 추천
바이트 코드로 컴파일한 다음 실행
> 바인딩(호스트 언어와 상호작용)을 어떻게 만들지 고려해야함

### 구문 분석, 실행
컴파일러 수업을 들었으면 됨
선택지와 참고자료도 많음
따로 안만들고 Lua같은 언어의 틀 안에서 만들어도 됨

비용 예측이 어려움
-> 열악한 레거시 개발환경에 적응하지는 않나?
-> 도메인 언어를 사용하면 좋은데 놓치고 있지는 않나?
그래서 **VS Code**
visual studio랑은 java와 javascript의 관계정도

## 발표내용
루아 디버거, 카일루아 언어 지원 을 붙여본 경험
-> 비용예측, 시행착오 에 관해

## 루아 디버거
공식문서도 존재함
**디버그 어댑터**를 만들어야 함 : 디버거와 code사이를 중개
아무 언어로나 만들어도 됨
code랑은 stdin, stdout으로 통신
요청/응답 메시지 16가지와 이벤트 메시지 2가지만 구현하면 됨

### 근데 디버거는 어떻게 만들지?
다른 프로세스 실행 제어, 내부를 들여다 볼 수 있어야 함
구문 분석 트리를 디버깅 하는건 너무 저수준임
-> 프로세스가 자신을 디버깅할 수 있는 인터페이스 제공 -> TCP소켓이 가장 만만함

### 구성
디버그 어댑터
- code와 CDP통신
- 디버그 대상과 tcp통신
- 디버그 대상을 실행

디버그 대상
- tcp를 통해 디버깅 명령을 받음

### lua debugger by devcat
마음에 드는 루아 디버거가 없어서 만듬
vscode 확장 검색창에 devcat을 입력

### 조금 더 깊게 설명
debug라이브러리가 있음
그 뒤로는 뭔지 모르겠네

만드는데 5주 걸림
code로 디버깅되게 하는데 3주 걸림 : 많이 안걸린거

### 팁
1. 프로토콜 문서를 참고하자
2. 기존 디버거 확장을 클론해서 시작하자
데브캣스튜디오/vscode lua debug 레포 추천
vscode-mono-debug 에서 클론
3. 실행기에 디버깅 기능을 표함해도 된다
4. CDP를 디버그 대상이 이해해도 된다

## Part B : 언어 확장 개발하기
### 작년 ndc 16 내용 조금 재탕
대책없는 기술부채, Lua의 늪
카일루나 : 루아와 같은 문법의 정적 언어, Rust로 작성
주석을 활용해 타입을 지정할 수 있음

### 카일루아의 IDE지원 : 오늘 발표 내용
Visual Studio는 거대한 레거시 덩어리
Visual Studio Code라는 희망, 오픈소스 크로스플랫폼, 확장을 만들기 쉬움, TypeScript

### 내가 만든 언어를 VS Code에 연동하려면 어떻게 해야하나
도움이 되는 조언을 중심으로 소개
IDE 연동 : 문법 강조 -> 실시간 체크 및 오류 표시 -> 정의로 가기, 이름 바꾸기 -> 자동완성
순으로 어려움

#### 문법 강조
가장 쉬움, 코드를 짤 필요가 없음
정규표현식을 알긴 알아야 함
문법 강조가 쉬운 쪽으로 언어를 바꾸는 게 여러 모로 이득
코드를 짜야하는 경우 : 테마 색상과 상관 없이 원하는 색깔을 표시하고 싶은 경우, 지역변수와 전역 변수를 다른 색깔로(문법적으로는 같은 경우)

#### 실시간 체크 및 오류 표시
언어 서버를 구현하면 쉬움
vscode는 TypeScript이라서 별도의 서버와 꼬마 확장(TypeScript)이 통신함
언어 서버는 언어에 제약 없으니까
편집기랑 독립적, 좀 느려도 되니 동시에 여러 번 돌리지 않도록 조심
IDE와 오류 메시지의 문제

#### 정의로 가기, 이름 찾아 바꾸기
함수인지 변수인지, 대응되는 정의가 어디있는 지도 저장
야매로 구현해도 쓸만함

정의로 가는 게 동작하면 이름 찾아 바꾸는 건 쉬움
같은 이름의 변수여도 정의가 다르니 다른 변수다 판단할 수 있음

타입 정보도 마찬가지

구문 분석
-> 타입 체크
-> IDE지원 : 어차피 반복하게 되니 반복하면서 IDE지원ㄷ 병행

#### 자동완성
제일 어려움
현재 위치에서 어떤 문법 요소가 가능한지 알아내는게 특히 어려움
노가다가 필요함, 재활용이 안됨
처음부터 하는건 추천하진 않음

github.com/devcat-studio/kailua 에 공개되어있음